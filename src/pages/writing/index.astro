---
// Writing index page - lists all blog posts
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

// Get all posts from the 'writing' collection
const allPosts = await getCollection('writing');

// Filter out drafts and sort by date (newest first)
const publishedPosts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

// Format date helper function
// Takes a Date object and returns "January 15, 2026"
function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
}
---

<Layout title="Writing · Luis Monbo">
	<div class="max-w-none">
		<h1 class="text-4xl font-bold tracking-tight mb-4">Writing</h1>

		<p class="text-lg text-gray-700 leading-relaxed mb-12">
			Essays on politics, philosophy, and technology. I write to clarify my thinking and occasionally share what I learn.
		</p>

		<!-- Posts list -->
		<div class="space-y-10">
			{publishedPosts.map(post => (
				<article class="group">
					<a href={`/writing/${post.slug}`} class="block">
						<!-- Post title -->
						<h2 class="text-2xl font-semibold tracking-tight mb-2 group-hover:text-gray-600 transition-colors">
							{post.data.title}
						</h2>

						<!-- Date and tags -->
						<div class="flex items-center gap-3 text-sm text-gray-500 mb-3">
							<time datetime={post.data.pubDate.toISOString()}>
								{formatDate(post.data.pubDate)}
							</time>

							{post.data.tags && post.data.tags.length > 0 && (
								<span class="text-gray-300">·</span>
							)}

							{post.data.tags && post.data.tags.map(tag => (
								<span class="text-gray-400">#{tag}</span>
							))}
						</div>

						<!-- Description/excerpt -->
						<p class="text-gray-700 leading-relaxed">
							{post.data.description}
						</p>
					</a>
				</article>
			))}
		</div>
	</div>
</Layout>
